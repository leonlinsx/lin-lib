---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import { normalizeCategory } from '../../../../utils/text';
import { buildPaginationHref } from '../../../../utils/pagination';

async function getCategories() {
  const posts = await getCollection('blog');

  return Array.from(
    new Set(posts.map((post) => normalizeCategory(post.data.category ?? ''))),
  )
    .filter(Boolean)
    .sort((a, b) => a.localeCompare(b));
}

export const getStaticPaths = (async () => {
  const categories = await getCategories();

  return categories.map((category) => ({
    params: { category },
  }));
}) satisfies GetStaticPaths;

const { category } = Astro.params;

if (!category) {
  throw new Error('Missing category');
}

return Astro.redirect(buildPaginationHref(1, category));
---
